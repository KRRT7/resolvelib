Fix calls to opaque objects and use provider interface calls instead.
